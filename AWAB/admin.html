<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>إدارة Awab Photography</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#000; color:#eee; direction:rtl; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; }
h1 { color:#ffae00; }
form { background:#111; padding:20px; border-radius:10px; max-width:400px; width:100%; }
input, textarea { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:none; }
button { background:#ffae00; color:#000; padding:10px 15px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
button:hover { background:#ffbe33; }
#logout-btn { margin-top:15px; background:#c00; color:#fff; }
</style>
</head>
<body>

<h1>صفحة الإدارة</h1>

<!-- تسجيل الدخول -->
<div id="login-section">
  <form id="login-form">
    <input type="email" id="email" placeholder="البريد الإلكتروني" required />
    <input type="password" id="password" placeholder="كلمة المرور" required />
    <button type="submit">تسجيل الدخول</button>
  </form>
</div>

<!-- إضافة مطعم -->
<div id="admin-section" style="display:none;">
  <form id="add-restaurant-form">
    <input type="text" id="restaurant-name" placeholder="اسم المطعم" required />
    <textarea id="image-urls" placeholder="أدخل روابط الصور (كل رابط في سطر)" required></textarea>
    <button type="submit">إضافة المطعم</button>
  </form>
  <button id="logout-btn">تسجيل الخروج</button>
</div>

<script type="module">
// Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDMAk-LMcuwQQL7PWaIRFrRDZ7Tku0MbwA",
  authDomain: "awab-photography-77c9f.firebaseapp.com",
  databaseURL: "https://awab-photography-77c9f-default-rtdb.firebaseio.com",
  projectId: "awab-photography-77c9f",
  storageBucket: "awab-photography-77c9f.appspot.com",
  messagingSenderId: "671706718039",
  appId: "1:671706718039:web:500f8901b4284df5896812",
  measurementId: "G-36TCVGKQK2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// عناصر HTML
const loginSection = document.getElementById("login-section");
const adminSection = document.getElementById("admin-section");
const loginForm = document.getElementById("login-form");
const addForm = document.getElementById("add-restaurant-form");
const logoutBtn = document.getElementById("logout-btn");

// تسجيل الدخول
loginForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  signInWithEmailAndPassword(auth, email, password)
    .then(() => alert("تم تسجيل الدخول بنجاح"))
    .catch(err => alert("خطأ في تسجيل الدخول: " + err.message));
});

// دالة لتحويل روابط Google Drive
function convertDriveLink(url) {
  const match = url.match(/\/d\/(.*?)\//);
  if (match && match[1]) {
    return `https://drive.google.com/uc?export=view&id=${match[1]}`;
  }
  return url; // إذا لم يكن رابط Drive، يترك كما هو
}

// إضافة مطعم
addForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const name = document.getElementById("restaurant-name").value;
  const imageUrls = document.getElementById("image-urls").value
    .split("\n")
    .map(url => convertDriveLink(url.trim()))
    .filter(url => url);

  push(ref(db, "restaurants"), {
    name: name,
    images: imageUrls
  }).then(() => {
    alert("تمت إضافة المطعم بنجاح");
    addForm.reset();
  }).catch(err => alert("حدث خطأ: " + err.message));
});

// مراقبة حالة تسجيل الدخول
onAuthStateChanged(auth, (user) => {
  if (user) {
    loginSection.style.display = "none";
    adminSection.style.display = "block";
  } else {
    loginSection.style.display = "block";
    adminSection.style.display = "none";
  }
});

// تسجيل الخروج
logoutBtn.addEventListener("click", () => {
  signOut(auth);
});
</script>

</body>
</html>
