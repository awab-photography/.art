<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… - Awab Photography</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#000; color:#eee; direction:rtl; }
header { background:#000; padding:20px; text-align:center; border-bottom:2px solid #ffae00; }
header h1 { color:#ffae00; }
main { max-width:900px; margin:20px auto; padding:20px; }
button { background:#ffae00; color:#000; border:none; padding:8px 15px; margin:5px; cursor:pointer; border-radius:5px; font-weight:bold; }
button:hover { background:#e09b00; }
input, select { padding:8px; margin:5px 0; width:100%; border-radius:5px; border:none; }
.restaurant-images { display:grid; grid-template-columns:repeat(auto-fit, minmax(120px,1fr)); gap:10px; }
.restaurant-images img { width:100%; border-radius:8px; border:2px solid #444; }
.image-actions { text-align:center; margin-top:5px; }
.separator { height:2px; background:#ffae00; margin:20px 0; }
.section-box { border:2px solid #ffae00; padding:15px; border-radius:8px; margin-bottom:20px; }
</style>
</head>
<body>

<header>
  <h1>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h1>
</header>

<main>

  <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯ -->
  <section class="section-box">
    <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯</h2>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…:</label>
    <input type="text" id="newRestaurantName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…" />

    <label>ØµÙˆØ± Ø§Ù„Ù…Ø·Ø¹Ù… (Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø© ØµÙˆØ± Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©):</label>
    <input type="text" id="newRestaurantImages" placeholder="Ù…Ø«Ø§Ù„: img1.jpg, img2.jpg, Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©" />

    <button id="addRestaurantBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ø¹Ù…</button>
  </section>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… -->
  <section class="section-box">
    <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h2>
    <select id="restaurantSelect">
      <option value="">-- Ø§Ø®ØªØ± Ù…Ø·Ø¹Ù… --</option>
    </select>
  </section>

  <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø·Ø¹Ù… -->
  <div id="restaurantDetails" style="display:none;">
    <div class="separator"></div>
    <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø·Ø¹Ù…</h2>
    <label>ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…:</label>
    <input type="text" id="editNameInput" />
    <button id="saveNameBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…</button>
    <button id="deleteRestaurantBtn" style="background:red;color:white;">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§</button>

    <div class="separator"></div>
    <h3>Ø§Ù„ØµÙˆØ±</h3>
    <div id="imagesContainer" class="restaurant-images"></div>

    <div class="separator"></div>
    <h3>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <label>Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø© ØµÙˆØ± Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©:</label>
    <input type="text" id="newImageInput" placeholder="Ù…Ø«Ø§Ù„: img3.jpg, Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©" />
    <button id="addImageBtn">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±</button>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDMAk-LMcuwQQL7PWaIRFrRDZ7Tku0MbwA",
  authDomain: "awab-photography-77c9f.firebaseapp.com",
  databaseURL: "https://awab-photography-77c9f-default-rtdb.firebaseio.com",
  projectId: "awab-photography-77c9f",
  storageBucket: "awab-photography-77c9f.appspot.com",
  messagingSenderId: "671706718039",
  appId: "1:671706718039:web:500f8901b4284df5896812"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const restaurantSelect = document.getElementById("restaurantSelect");
const restaurantDetails = document.getElementById("restaurantDetails");
const editNameInput = document.getElementById("editNameInput");
const saveNameBtn = document.getElementById("saveNameBtn");
const deleteRestaurantBtn = document.getElementById("deleteRestaurantBtn");
const imagesContainer = document.getElementById("imagesContainer");
const newImageInput = document.getElementById("newImageInput");
const addImageBtn = document.getElementById("addImageBtn");

const newRestaurantName = document.getElementById("newRestaurantName");
const newRestaurantImages = document.getElementById("newRestaurantImages");
const addRestaurantBtn = document.getElementById("addRestaurantBtn");

let restaurantsData = {};
let currentRestaurantKey = "";

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±Ø©
onValue(ref(db, "restaurants"), snapshot => {
  restaurantsData = snapshot.val() || {};
  restaurantSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø·Ø¹Ù… --</option>';
  Object.keys(restaurantsData).forEach(key => {
    const opt = document.createElement("option");
    opt.value = key;
    opt.textContent = restaurantsData[key].name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
    restaurantSelect.appendChild(opt);
  });
});

// Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø·Ø¹Ù…
restaurantSelect.addEventListener("change", () => {
  currentRestaurantKey = restaurantSelect.value;
  if (currentRestaurantKey) {
    const rest = restaurantsData[currentRestaurantKey];
    restaurantDetails.style.display = "block";
    editNameInput.value = rest.name || "";

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØµÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
    onValue(ref(db, `restaurants/${currentRestaurantKey}/images`), snapshot => {
      const images = snapshot.val() || [];
      renderImages(images);
    });
  } else {
    restaurantDetails.style.display = "none";
  }
});

// Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
function renderImages(images) {
  imagesContainer.innerHTML = "";
  images.forEach((imgUrl, index) => {
    const div = document.createElement("div");
    const img = document.createElement("img");

    img.src = imgUrl.startsWith("http") ? imgUrl : `images/${imgUrl}`;

    const actions = document.createElement("div");
    actions.className = "image-actions";
    const delBtn = document.createElement("button");
    delBtn.textContent = "ğŸ—‘ Ø­Ø°Ù";
    delBtn.style.background = "red";
    delBtn.style.color = "white";
    delBtn.onclick = () => deleteImage(index);
    actions.appendChild(delBtn);

    div.appendChild(img);
    div.appendChild(actions);
    imagesContainer.appendChild(div);
  });
}

// Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…
saveNameBtn.onclick = () => {
  const newName = editNameInput.value.trim();
  if (!newName) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…");
  update(ref(db, `restaurants/${currentRestaurantKey}`), { name: newName })
    .then(() => alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­"))
    .catch(err => alert("Ø®Ø·Ø£: " + err));
};

// Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§
deleteRestaurantBtn.onclick = () => {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ")) {
    remove(ref(db, `restaurants/${currentRestaurantKey}`))
      .then(() => {
        alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§");
        restaurantDetails.style.display = "none";
        restaurantSelect.value = "";
      })
      .catch(err => alert("Ø®Ø·Ø£: " + err));
  }
};

// Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©
addImageBtn.onclick = () => {
  const imgValue = newImageInput.value.trim();
  if (!imgValue) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙˆØ±");
  
  const newImages = imgValue.split(",").map(s => s.trim()).filter(s => s);
  const rest = restaurantsData[currentRestaurantKey];
  const updatedImages = [...(rest.images || []), ...newImages];

  update(ref(db, `restaurants/${currentRestaurantKey}`), { images: updatedImages })
    .then(() => {
      newImageInput.value = "";
    })
    .catch(err => alert("Ø®Ø·Ø£: " + err));
};

// Ø­Ø°Ù ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø©
function deleteImage(index) {
  const rest = restaurantsData[currentRestaurantKey];
  const updatedImages = rest.images.filter((_, i) => i !== index);

  update(ref(db, `restaurants/${currentRestaurantKey}`), { images: updatedImages })
    .then(() => alert("ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­"))
    .catch(err => alert("Ø®Ø·Ø£: " + err));
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯
addRestaurantBtn.onclick = () => {
  const name = newRestaurantName.value.trim();
  const imagesInput = newRestaurantImages.value.trim();

  if (!name) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…");

  const imagesArray = imagesInput ? imagesInput.split(",").map(s => s.trim()).filter(s => s) : [];

  push(ref(db, "restaurants"), {
    name: name,
    images: imagesArray
  })
  .then(() => {
    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­");
    newRestaurantName.value = "";
    newRestaurantImages.value = "";
  })
  .catch(err => alert("Ø®Ø·Ø£: " + err));
};
</script>

</body>
</html>
