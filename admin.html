<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… - Awab Photography</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#000; color:#eee; direction:rtl; position:relative; overflow-x:hidden; }
/* ===== Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø°Ù‡Ø¨ÙŠØ© ===== */
.background {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: -1;
  background: radial-gradient(circle at center, rgba(255,174,0,0.15) 0%, transparent 70%);
  overflow: hidden;
}
.line {
  position: absolute;
  width: 2px; height: 120%;
  background: linear-gradient(180deg, transparent, #ffae00, transparent);
  opacity: 0.5;
  animation: move 6s linear infinite;
}
@keyframes move {
  from { transform: translateY(-100%); }
  to   { transform: translateY(100%); }
}
/* ===== ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© ===== */
header { background:#000; padding:20px; text-align:center; border-bottom:2px solid #ffae00; }
header h1 { color:#ffae00; }
main { max-width:900px; margin:20px auto; padding:20px; }
button { background:#ffae00; color:#000; border:none; padding:8px 15px; margin:5px; cursor:pointer; border-radius:5px; font-weight:bold; }
button:hover { background:#e09b00; }
input, select { padding:8px; margin:5px 0; width:100%; border-radius:5px; border:none; }
.restaurant-images { display:grid; grid-template-columns:repeat(auto-fit, minmax(120px,1fr)); gap:10px; }
.restaurant-images img { width:100%; border-radius:8px; border:2px solid #444; }
.image-actions { text-align:center; margin-top:5px; }
.separator { height:2px; background:#ffae00; margin:20px 0; }
#loginForm { max-width:400px; margin:80px auto; background:#111; padding:20px; border-radius:10px; border:2px solid #ffae00; }
#loginForm h2 { color:#ffae00; text-align:center; }
#errorMsg { color:red; text-align:center; font-size:14px; margin-top:10px; }
</style>
</head>
<body>

<!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
<div class="background" id="background"></div>

<header>
  <h1>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h1>
</header>

<!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginForm">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <form autocomplete="off">
    <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="off" />
    <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="new-password" />
    <button type="button" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
  </form>
  <div id="errorMsg"></div>
</div>

<!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
<main id="adminPanel" style="display:none;">
  <section>
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="newRestaurantName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…" />
    <input type="text" id="newRestaurantImages" placeholder="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)" />
    <input type="file" id="newRestaurantFile" multiple />
    <button id="addRestaurantBtn">Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù…</button>
  </section>

  <div class="separator"></div>

  <section>
    <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h2>
    <select id="restaurantSelect">
      <option value="">-- Ø§Ø®ØªØ± Ù…Ø·Ø¹Ù… --</option>
    </select>
  </section>

  <div id="restaurantDetails" style="display:none;">
    <div class="separator"></div>
    <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø·Ø¹Ù…</h2>
    <label>ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…:</label>
    <input type="text" id="editNameInput" />
    <button id="saveNameBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…</button>
    <button id="deleteRestaurantBtn" style="background:red;color:white;">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…</button>

    <div class="separator"></div>
    <h3>Ø§Ù„ØµÙˆØ±</h3>
    <div id="imagesContainer" class="restaurant-images"></div>

    <div class="separator"></div>
    <h3>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <input type="text" id="newImageInput" placeholder="Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ±" />
    <input type="file" id="newImageFile" multiple />
    <button id="addImageBtn">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js";

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDMAk-LMcuwQQL7PWaIRFrRDZ7Tku0MbwA",
  authDomain: "awab-photography-77c9f.firebaseapp.com",
  databaseURL: "https://awab-photography-77c9f-default-rtdb.firebaseio.com",
  projectId: "awab-photography-77c9f",
  storageBucket: "awab-photography-77c9f.firebasestorage.app",
  messagingSenderId: "671706718039",
  appId: "1:671706718039:web:500f8901b4284df5896812",
  measurementId: "G-36TCVGKQK2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const storage = getStorage(app);

// Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„
const allowedEmail = "awab.albaraa@gmail.com";

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
loginBtn.onclick = () => {
  signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
    .catch(() => errorMsg.textContent = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
};

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
onAuthStateChanged(auth, user => {
  if (user && user.email === allowedEmail) {
    loginForm.style.display = "none";
    adminPanel.style.display = "block";
    loadRestaurants();
  } else if (user && user.email !== allowedEmail) {
    alert("âš ï¸ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©");
    signOut(auth);
    window.location.href = "index.html";
  } else {
    loginForm.style.display = "block";
    adminPanel.style.display = "none";
  }
});

let restaurantsData = {};
let currentRestaurantKey = "";

function loadRestaurants() {
  onValue(ref(db, "restaurants"), snapshot => {
    restaurantsData = snapshot.val() || {};
    restaurantSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ø·Ø¹Ù… --</option>';
    Object.keys(restaurantsData).forEach(key => {
      const opt = document.createElement("option");
      opt.value = key;
      opt.textContent = restaurantsData[key].name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
      restaurantSelect.appendChild(opt);
    });
    if (currentRestaurantKey && restaurantsData[currentRestaurantKey]) {
      const rest = restaurantsData[currentRestaurantKey];
      editNameInput.value = rest.name || "";
      renderImages(rest.images || []);
      restaurantDetails.style.display = "block";
    }
  });
}

restaurantSelect.addEventListener("change", () => {
  currentRestaurantKey = restaurantSelect.value;
  if (currentRestaurantKey) {
    const rest = restaurantsData[currentRestaurantKey];
    restaurantDetails.style.display = "block";
    editNameInput.value = rest.name || "";
    renderImages(rest.images || []);
  } else {
    restaurantDetails.style.display = "none";
  }
});

function renderImages(images) {
  imagesContainer.innerHTML = "";
  images.forEach((imgUrl, index) => {
    const div = document.createElement("div");
    const img = document.createElement("img");
    img.src = imgUrl;
    const actions = document.createElement("div");
    actions.className = "image-actions";
    const delBtn = document.createElement("button");
    delBtn.textContent = "ğŸ—‘ Ø­Ø°Ù";
    delBtn.style.background = "red";
    delBtn.style.color = "white";
    delBtn.onclick = () => deleteImage(index);
    actions.appendChild(delBtn);
    div.appendChild(img);
    div.appendChild(actions);
    imagesContainer.appendChild(div);
  });
}

// Ø±ÙØ¹ ØµÙˆØ± Ø¥Ù„Ù‰ Firebase Storage
async function uploadFiles(files) {
  const urls = [];
  for (const file of files) {
    const fileRef = storageRef(storage, 'restaurant_images/' + Date.now() + '_' + file.name);
    await uploadBytes(fileRef, file);
    const url = await getDownloadURL(fileRef);
    urls.push(url);
  }
  return urls;
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯
addRestaurantBtn.onclick = async () => {
  const name = newRestaurantName.value.trim();
  if (!name) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…");
  let images = newRestaurantImages.value.trim().split(",").filter(Boolean);
  if (newRestaurantFile.files.length > 0) {
    const uploadedUrls = await uploadFiles(newRestaurantFile.files);
    images = images.concat(uploadedUrls);
  }
  const newKey = Date.now().toString();
  update(ref(db, `restaurants/${newKey}`), { name, images })
    .then(() => {
      newRestaurantName.value = "";
      newRestaurantImages.value = "";
      newRestaurantFile.value = "";
      alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­");
    });
};

// Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…
saveNameBtn.onclick = () => {
  const newName = editNameInput.value.trim();
  if (!newName) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…");
  update(ref(db, `restaurants/${currentRestaurantKey}`), { name: newName });
};

// Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø· (Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ + Ø¥Ø²Ø§Ù„Ø© ÙÙˆØ±ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
deleteRestaurantBtn.onclick = () => {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ")) {
    const key = currentRestaurantKey;
    remove(ref(db, `restaurants/${key}`))
      .then(() => {
        // Ø¥Ø²Ø§Ù„Ø© ÙÙˆØ±ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        const option = [...restaurantSelect.options].find(o => o.value === key);
        if (option) option.remove();
        restaurantSelect.value = "";
        restaurantDetails.style.display = "none";
        currentRestaurantKey = "";
        alert("ğŸ—‘ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…");
      })
      .catch(() => alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù"));
  }
};

// Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
addImageBtn.onclick = async () => {
  const rest = restaurantsData[currentRestaurantKey];
  let updatedImages = rest.images || [];
  if (newImageInput.value.trim()) {
    updatedImages = updatedImages.concat(newImageInput.value.trim().split(",").filter(Boolean));
  }
  if (newImageFile.files.length > 0) {
    const uploadedUrls = await uploadFiles(newImageFile.files);
    updatedImages = updatedImages.concat(uploadedUrls);
  }
  update(ref(db, `restaurants/${currentRestaurantKey}`), { images: updatedImages })
    .then(() => {
      newImageInput.value = "";
      newImageFile.value = "";
      alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
    });
};

// Ø­Ø°Ù ØµÙˆØ±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
function deleteImage(index) {
  const rest = restaurantsData[currentRestaurantKey];
  const updatedImages = rest.images.filter((_, i) => i !== index);
  update(ref(db, `restaurants/${currentRestaurantKey}`), { images: updatedImages })
    .then(() => alert("ğŸ—‘ ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…"))
    .catch(() => alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù"));
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·ÙˆØ· Ø°Ù‡Ø¨ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ø®Ù„ÙÙŠØ©
const bg = document.getElementById("background");
for (let i = 0; i < 20; i++) {
  const line = document.createElement("div");
  line.className = "line";
  line.style.left = Math.random() * 100 + "vw";
  line.style.animationDuration = (4 + Math.random() * 6) + "s";
  bg.appendChild(line);
}
</script>

</body>
</html>
